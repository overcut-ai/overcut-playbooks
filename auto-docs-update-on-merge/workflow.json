{
  "_formatVersion": "1.0.0",
  "workflow": {
    "name": "Auto Docs Update on Merge",
    "description": "Look for changes after a pull request is merged and update the documentation accordingly.",
    "instructions": [
      {
        "description": "This is a multi-repo workflow. Overcut will automatically create a PR on  your documentation repo every time you `merge a PR to the main branch` on the product repo, or when you add a comment with the command `/update-docs` on the PR. Overcut will analyze code changes and create a new PR on the documentation repo to update API docs, and other documentation to reflect new features and changes.",
        "action": "merge_pr"
      }
    ],
    "definition": {
      "flow": [
        {
          "to": "clone-code",
          "from": "",
          "condition": null
        },
        {
          "to": "clone-docs",
          "from": "clone-code",
          "condition": null
        },
        {
          "to": "plan-docs",
          "from": "clone-docs",
          "condition": null
        }
      ],
      "name": "Auto Docs Update on Merge",
      "steps": [
        {
          "id": "clone-code",
          "name": "Clone Source Repo",
          "action": "git.clone",
          "params": {
            "branch": "",
            "cloneOptions": {
              "depth": 1,
              "singleBranch": true
            },
            "repoFullName": "{{trigger.repository.fullName}}"
          },
          "instruction": null,
          "stepMaxDurationMinutes": 30
        },
        {
          "id": "clone-docs",
          "name": "Clone Docs Repo",
          "action": "git.clone",
          "params": {
            "branch": "",
            "cloneOptions": {
              "depth": 1,
              "singleBranch": true
            },
            "repoFullName": "my-org/docs"
          },
          "instruction": null,
          "stepMaxDurationMinutes": 30
        },
        {
          "id": "plan-docs",
          "name": "Upadte Docs",
          "action": "agent.session",
          "params": {
            "goal": "Update the docs site",
            "agentIds": [
              "cmck3058o0004wtwy3dqwsf8y",
              "cmck2zjey0002wtwywdu02pi7",
              "cmck2zx350003wtwyxm0w6g6p"
            ],
            "agentEngine": "overcut",
            "exitCriteria": {
              "timeLimit": {
                "maxDurationMinutes": 10
              },
              "userSignals": {
                "explicit": ["/done", "thanks"]
              }
            },
            "listenToComments": false,
            "keepSessionOpenForComments": false
          },
          "instruction": "You are the **Coordinator Agent** responsible for ensuring documentation updates are properly managed whenever a product Pull Request is created.\n\nYou will delegate specific tasks to sub-agents:\n\n- **Developer Agent** → Analyze product changes and identify required documentation updates.\n- **Tech Writer Agent** → Plan and structure documentation tasks around features or values.\n\n---\n\n### Process\n\n1. **Analyze the Product PR**\n\n   - Delegate to the **Developer Agent**:  \n     • Review the code changes in the product repository.  \n     • Identify which changes impact **customer-facing functionality** and are relevant to Overcut end-users.  \n     • Documentation focuses on concepts, guides, tutorials, and pages — not API references.  \n     • Ignore PRs that only include internal updates (e.g., APIs, internal types, Kafka messages, table schemas, or logic not visible to users).  \n     • Return one of the following:\n     - **If documentation is required:**  \n       A structured list describing each change that affects customer experience, including:\n       - Name/identifier of the feature or functionality\n       - Type of change (new feature, update, fix, removal)\n       - Brief explanation of its user-facing impact\n       - Reference to related files or modules (for context only)\n       - do not include changes to env variables, internal functions, API endpoints etc.\n     - **If no documentation is required:**  \n       Return explicitly:  \n       `\"No customer-facing documentation updates are required for this PR.\"`\n\n2. **Plan Documentation Updates by Feature or Value** (Planning Only - Do NOT Create Issues Yet)\n\n   - If the Developer Agent identified documentation needs:\n\n     - Delegate to the **Tech Writer Agent** to **create a plan** (not issues yet):  \n       • Review the structured list of changes from Step 1.  \n       • Analyze the **current state of documentation** in the docs repository.  \n       • **Check for existing open issues** with `needs-docs-update` label to avoid duplicates.  \n       • Identify **documentation gaps** by comparing the existing docs to the actual feature changes.\n\n       • **Grouping Strategy** - Group by logical feature/value WHILE considering file conflicts:\n\n       **Primary principle:** Group by **logical feature or value area**\n\n       Examples of good grouping:\n\n       - \"Document Workflow Timeout Configuration\" (includes config option, behavior, error handling)\n       - \"Document New Scheduler Features\" (includes all scheduler-related changes)\n       - \"Document Updated Role Permissions\" (includes all permission changes)\n\n       **Conflict avoidance rules:**\n\n       - If multiple changes belong to the **same logical feature** AND will update the **same documentation file**, keep them in ONE issue\n       - If changes are **complementary parts** of the same feature (e.g., new config option + its behavior + error messages), group them together\n       - If multiple changes will update the **same file** but are **different features**, still separate them BUT note the potential overlap\n       - Only split into separate issues when changes are truly **independent features** that touch **different files**\n       - Prefer **fewer, cohesive issues** over many fragmented ones\n\n       • Do **not** split complementary parts of the same feature just because they touch different aspects.\n       • Do not add or update release notes.\n\n       • For each planned issue, provide:\n\n       - Title (clear summary of what will be documented)\n       - Description of what needs to be updated or added\n       - Likely documentation files that will be affected (critical for conflict detection)\n       - Suggested structure and sections\n       - Related product PR link\n\n       • Return the full plan for Coordinator review .\n\n3. **Create Documentation Tickets (Execution)**\n\n   - **After the Coordinator reviews and approves the plan from Step 2**:\n\n     - Delegate to the **Tech Writer Agent** to **NOW create the actual issues** in the docs repository.\n     - Create **one issue for each item in the approved plan**.\n\n     - **Before creating each issue**:\n       • Double-check if an existing open issue with `needs-docs-update` label already covers this documentation need\n       • If an existing issue covers it, skip creating a duplicate and note it in the summary\n\n     - Each issue represents one **cohesive documentation task** (may include multiple related changes from the same feature).\n\n     - Each issue **must include**:  \n       • **Title** describing what will be documented (e.g., \"Document workflow timeout configuration and error handling\")\n       • **Summary** of what needs to be updated or added\n       • **User impact** - explanation of why this matters to users\n       • **Link to the product PR** (CRITICAL - the implementation workflow needs this to understand the feature)\n       • **Likely affected files** (e.g., \"Will likely update: docs/reference/workflow-config.mdx\")\n       • **Context** - any existing doc references or navigation updates needed\n       • **Label**: `needs-docs-update`\n\n     - Return a summary list of all created issue URLs for Coordinator reference.\n\n4. **Notify in Product PR**\n\n   - Delegate to the **Developer Agent** to post a comment on the original product PR, including:\n     - A summary of identified documentation work.\n     - Links to all created issues in the docs repository.\n\n5. **If No Docs Needed**\n   - If the Developer Agent explicitly reports no customer-facing changes:\n     - Delegate to the **Developer Agent** to comment on the product PR:  \n       \"Reviewed the changes — no customer-facing documentation updates are required.\"\n\n---\n\n### Guardrails\n\n- Each issue must represent a **cohesive documentation task** around a logical feature or value area.\n- **Prefer grouping related changes** that will touch the same documentation files to avoid conflicts.\n- Do **not** create separate issues for complementary parts of the same feature.\n- Do **not** split unnecessarily - fewer cohesive issues are better than many fragmented ones.\n- All issues must reference `.mdx` files and Mintlify conventions.\n- Do **not** include internal APIs, schemas, or implementation details.\n- Each ticket must be independently actionable without dependencies on other tickets.\n- **Always check** that no existing open issue with `needs-docs-update` label already covers the described change.\n- Each issue **must include** a link to the product PR for the implementation workflow to use as reference.",
          "stepMaxDurationMinutes": 30
        }
      ],
      "trigger": {
        "event": "pull_request_merged",
        "schedule": null,
        "settings": {
          "delaySeconds": 0
        },
        "conditions": {
          "field": null,
          "rules": [
            {
              "field": "context.pullRequest.baseBranch",
              "rules": null,
              "value": "main",
              "operator": "equals",
              "combinator": null
            }
          ],
          "value": null,
          "operator": null,
          "combinator": "and"
        },
        "slashCommand": {
          "command": "update-docs",
          "requireMention": false
        }
      },
      "version": "1.0.0",
      "priority": 5,
      "timeoutMs": null
    }
  },
  "refs": {
    "agents": [
      {
        "id": "cmck2zjey0002wtwywdu02pi7",
        "name": "Product manager"
      },
      {
        "id": "cmck2zx350003wtwyxm0w6g6p",
        "name": "Senior Developer"
      },
      {
        "id": "cmck3058o0004wtwy3dqwsf8y",
        "name": "Tech Writer"
      }
    ]
  }
}
