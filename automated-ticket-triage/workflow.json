{
  "_formatVersion": "1.0.0",
  "workflow": {
    "name": "Automated Ticket Triage ",
    "description": "Organize your backlog effortlessly. Overcut intelligently categorizes, labels, and prioritizes incoming tickets while detecting duplicates. It adds context to trigger downstream workflows and automatically delegates tasks to the right agents, ensuring efficient resolution.",
    "instructions": [
      {
        "description": "Overcut will automatically triage your issues every time you `create a new issue` or when you add a comment with the command `/triage`. Overcut will analyze issue content and apply appropriate labels, set priority levels, suggest assignees, and categorize based on content analysis.",
        "action": "create_issue"
      }
    ],
    "definition": {
      "flow": [
        {
          "to": "triage-ticket",
          "from": "git-clone",
          "condition": null
        },
        {
          "to": "identify-repos",
          "from": "",
          "condition": null
        },
        {
          "to": "git-clone",
          "from": "identify-repos",
          "condition": null
        }
      ],
      "name": "Automated Ticket Triage ",
      "steps": [
        {
          "id": "git-clone",
          "name": "Clone Repo",
          "action": "git.clone",
          "params": {
            "branch": "",
            "cloneOptions": {
              "depth": 1,
              "singleBranch": true
            },
            "repoFullName": "{{outputs.identify-repos}}"
          },
          "instruction": null
        },
        {
          "id": "triage-ticket",
          "name": "Triage Ticket",
          "action": "agent.session",
          "params": {
            "goal": "Coordinate and oversee the Automatic Ticket Triage process by guiding sub-agents to gather context, analyze tickets, and apply accurate, consistent classifications and updates.",
            "agentIds": ["cme8qusyf000brwpy8w8mm0rq"],
            "exitCriteria": {
              "timeLimit": {
                "maxDurationMinutes": 120
              },
              "userSignals": {
                "explicit": ["/done", "thanks"]
              }
            },
            "listenToComments": true,
            "keepSessionOpenForComments": false
          },
          "instruction": "You are an automated Ticket Triage Agent.\n\nPerformance Constraint:\n• To reduce token usage and avoid long runtimes, you MUST NOT scan or read all open tickets.\n• For duplicate detection, search using a SHORT keyword query derived from the title and pick ONLY the top 5–10 most relevant issues returned by the search API.\n• Do not iterate through the entire issue list under any circumstance.\n\n## Process\n\n### Step 1 - Analyze Ticket\n1. Read the ticket title, description, current labels, and metadata.\n2. Determine the correct component and category based on the content.\n\n### Step 2 - Duplicate Detection\n1. Extract 3–5 key terms from the title/description for search.\n2. Run a keyword search using the repository search API.\n3. Evaluate ONLY the top 5–10 matched issues returned.\n4. If similarity ≥ 0.75, proceed to mark as duplicate in Step 3.\n\n### Step 3 - Apply Labels\n**CRITICAL**: You MUST use the appropriate tools to actually ADD labels to the ticket, not just comment about them.\n\nFor each required label:\n- Use the `update_ticket` tool to apply labels\n- Apply exactly one category label from the allowed list\n- Apply zero or one component label from the allowed list  \n- If duplicate detected, apply the `duplicate` label\n- If information is missing, apply the `needs-info` label\n\n### Step 4 - Complete Task\n- Use the `task_completed` tool to provide a concise summary of results\n- Include in summary: \n  - Labels applied to the ticket\n  - If duplicate found: link to duplicate issue and similarity score\n  - If needs-info applied: what information is missing\n- DO NOT include: list of tickets checked, tool names used, or implementation details\n- DO NOT post comments on the ticket body - only add labels and provide task summary\n- Optional: Suggest subtasks in the task_completed summary\n\nAllowed category labels (use exactly one):\nfeature, question, bug, chore, duplicate, developer-experience, cve\n\nAllowed component labels (choose zero or one):\ndatabase, ci, admin-ui, backend, api\n\n## Critical Requirements\n\n✅ **MUST DO**:\n- Use tools to actually ADD labels\n- Apply exactly one category label from the allowed list\n- Check current labels before adding to avoid duplicates (idempotency)\n- Use `task_completed` tool to provide concise summary focused on results\n- Include only valuable outcomes: labels applied, duplicate links, missing info details\n\n❌ **MUST NOT**:\n- Post comments on the ticket body mentioning label names\n- Use labels outside the allowed category and component lists\n- Iterate through all open tickets (use targeted search only)\n- Leak tokens, secrets, or personal data\n- Include implementation details in task summary (tool names, tickets checked, search process)\n\n## Guardrails\n• Idempotency: apply or change labels only when different from current state.\n• The task_completed summary must list all actions taken.\n• Do not invent or use labels outside the allowed list."
        },
        {
          "id": "identify-repos",
          "name": "Identify Repositories",
          "action": "repo.identify",
          "params": {
            "maxResults": 3,
            "minConfidence": 0.2,
            "identificationHints": "Give Priority to the component field."
          },
          "instruction": null
        }
      ],
      "triggers": [
        {
          "event": "issue_opened",
          "settings": {
            "delaySeconds": 120
          },
          "conditions": {
            "field": null,
            "rules": [],
            "value": null,
            "operator": null,
            "combinator": "and"
          },
          "schedule": null
        },
        {
          "event": "manual",
          "slashCommand": {
            "command": "triage",
            "requireMention": false
          }
        }
      ],
      "version": "1.0.0",
      "priority": 1,
      "timeoutMs": null
    }
  },
  "refs": {
    "agents": [
      {
        "id": "cme8qusyf000brwpy8w8mm0rq",
        "name": "Product Manager"
      }
    ]
  }
}
