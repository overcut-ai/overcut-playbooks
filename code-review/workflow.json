{
  "_formatVersion": "1.0.0",
  "workflow": {
    "name": "Code Review",
    "description": "Elevate your code quality with AI-powered reviews. Overcut provides thorough, context-aware feedback on your PRs, catching bugs, security issues, and style violations before they merge.",
    "instructions": [
      {
        "description": "Overcut will automatically review your PRs every time you `open a new PR` or when you add a comment with the command `/review` on any PR. Overcut will analyze your code changes, check for bugs, suggest improvements, and provide detailed feedback with inline comments.",
        "action": "create_pr"
      }
    ],
    "definition": {
      "flow": [
        {
          "to": "git-clone",
          "from": "",
          "condition": null
        },
        {
          "to": "prepare-review-plan",
          "from": "git-clone",
          "condition": null
        },
        {
          "to": "code-review",
          "from": "prepare-review-plan",
          "condition": null
        },
        {
          "to": "optimize-review-item",
          "from": "code-review",
          "condition": null
        },
        {
          "to": "submit-review",
          "from": "optimize-review-item",
          "condition": null
        }
      ],
      "name": "Code Review",
      "steps": [
        {
          "id": "git-clone",
          "name": "Clone Repo",
          "action": "git.clone",
          "params": {
            "branch": "{{trigger.pullRequest.headBranch}}",
            "cloneOptions": {
              "depth": 1,
              "filter": {
                "type": "blob:none"
              },
              "singleBranch": true
            },
            "repoFullName": "{{trigger.repository.fullName}}"
          },
          "instruction": null,
          "stepMaxDurationMinutes": 30
        },
        {
          "id": "prepare-review-plan",
          "name": "Prepare Review Plan",
          "action": "agent.run",
          "params": {
            "agentId": "cmck2zx350003wtwyxm0w6g6p"
          },
          "instruction": "Role: Code Review Planner  \nGoal: Create a concise, intent-based review plan for the pull request.\n\n1. Use get_pull_request_diff to inspect all file diffs.\n2. Identify the main _logical changes_ or _intents_ (e.g., new feature, refactor, schema update, test, doc, config).\n3. Group related file changes under one intent.\n4. For each intent, summarize:\n   \u2022 What was changed (1 short phrase)\n   \u2022 Why it matters for review (key concern)\n   \u2022 Optional: key files or modules (briefly)\n\nOutput format (one line per intent):\n\n1. [intent / feature] \u2014 [summary of what changed and what to review briefly]\n\nKeep the plan short and non-repetitive (max 5\u20138 items).  \nDo not restate every file or create detailed sub-bullets.  \nDo not review the code yet \u2014 just provide a compact list of review focuses.",
          "stepMaxDurationMinutes": 30
        },
        {
          "id": "code-review",
          "name": "Code Review",
          "action": "agent.session",
          "params": {
            "goal": "Code Review",
            "agentIds": [
              "cmfjcucnw001aldn5dqb89cv7"
            ],
            "agentEngine": "overcut",
            "exitCriteria": {
              "timeLimit": {
                "maxDurationMinutes": 10
              },
              "userSignals": {
                "explicit": [
                  "/done",
                  "thanks"
                ]
              }
            },
            "listenToComments": false,
            "keepSessionOpenForComments": false
          },
          "instruction": "You are the **Coordinator Agent** in an ongoing code review process.  \nYou are starting with a predefined list of review items, and your job is to:\n\n- For each review item: delegate to the **Code Reviewer** to ANALYZE and APPEND JSONL findings directly into `.overcut/review/scratchpad.jsonl`.\n- The Reviewer should return only a short status summary to chat.\n\n---\n\n## Process\n\n### Step 0 - Acknowledge\n\nUpdate the user with the `update_status` tool with a message that you are starting the code review.\n\n---\n\n### Step 1 - Per-item Analysis to Scratchpad\n\nFor each item in the list of review items, delegate to **Code Reviewer** this entire message in full \u2014 you must pass the schema.\n\nYou are acting as a **Code Reviewer**.  \nAnalyze the following [task].  \nDo **NOT** post any PR comments and do **NOT** call `submit_review`.  \nProduce findings matching the JSONL schema (below).  \nAppend each finding as a JSON line to `.overcut/review/scratchpad.jsonl` (this is a relative path from the workspace root \u2014 do NOT write inside the cloned repo folder).\nReturn ONLY a short status line to chat: `{file} - {count} findings`.\n\n> **Guidance**:\n>\n> - Focus on correctness, security, performance, tests, APIs, and standards.\n> - Keep summaries terse and user-facing.\n> - Use local anchors (snippet + up to 3 lines of context + hunk header + approx lines).\n> - Use `'blocker'` **only** for truly critical issues that would cause incorrect behavior or security risk.\n> - **Ignore lint-only or trivial formatting changes** (e.g., whitespace, commas, semicolons, import order, quote styles).\n> - Avoid adding low-confidence, speculative, or nitpick findings. Only include issues that are clearly justified and relevant to the PR changes.\n> - **Only comment on files that are part of the PR diff.** If a PR change (e.g., a dependency upgrade) would break a file that is NOT in the diff, attach the finding to the file in the PR that *causes* the issue (e.g., `package.json`), not the affected file outside the diff. The `file` field must always be a file that was changed in the PR.\n\n**Schema for each finding**:\n\n```json\n{\n  \"file\": \"path/to/file\",\n  \"importance\": \"blocker|major|minor|nit\",\n  \"title\": \"Short handle\",\n  \"message\": \"1-2 sentence user-facing comment\",\n  \"suggested_fix\": \"Optional concrete guidance or patch\",\n  \"line\": \"\",\n  \"side\": \"RIGHT|LEFT|UNKNOWN\"\n}\n```\n\n---\n\n### Step 2 - Complete and return a summary\n\nUse the `task_completed` tool to complete the task and return a summary of the review.\n\n**Output Requirements**:\n\nWhen the workflow completes, you MUST output the following information:\n\n```\nreview_comments_found: <yes|no>\ntotal_findings: <number of findings>\nscratchpad_file: .overcut/review/scratchpad.jsonl\n```\n\nExample outputs:\n\n**If findings were created:**\n\n```\nreview_comments_found: yes\ntotal_findings: 12\nscratchpad_file: .overcut/review/scratchpad.jsonl\n```\n\n**If no findings were created:**\n\n```\nreview_comments_found: no\ntotal_findings: 0\nscratchpad_file: .overcut/review/scratchpad.jsonl\n```",
          "stepMaxDurationMinutes": 120
        },
        {
          "id": "optimize-review-item",
          "name": "Optimize Review Items",
          "action": "agent.run",
          "params": {
            "agentId": "cmfjcucnw001aldn5dqb89cv7",
            "agentEngine": "overcut"
          },
          "instruction": "You are acting as a **Code Review Optimizer**.\nYou are given a list of review items on a PR.\nYour goal is to **filter and organize the existing findings** into a minimal, high-quality set \u2014 you are NOT validating or extending the review. The code analysis is already complete; your job is to process the list.\n\n---\n\n## \u26a0\ufe0f CRITICAL CONSTRAINTS\n\n**DO NOT** perform any of the following actions:\n\n- **DO NOT** read any source code files. Your input is ONLY `.overcut/review/scratchpad.jsonl`\n- **DO NOT** validate findings against the codebase \u2014 that was done in the previous step\n- **DO NOT** use `code_search`, `read_file` (except for scratchpad.jsonl), or browse the repository\n- **DO NOT** run terminal commands to inspect the codebase\n- **DO NOT** try to \"verify\" or \"confirm\" findings by looking at actual code\n\nYour job is to **PROCESS THE LIST**, not to verify correctness of individual findings.\n\n### Allowed Tools\n\nYou may ONLY use:\n\n| Tool | Purpose |\n|------|---------|\n| `update_status` | Notify progress |\n| `read_file` | ONLY for `.overcut/review/scratchpad.jsonl` |\n| `write_file` / `append_file` | ONLY for `.overcut/review/scratchpad.chunk*.jsonl` |\n| `list_dir` | ONLY for `.overcut/review/` directory |\n| `task_completed` | Finish the task |\n\n**Any other tool usage is OUT OF SCOPE and violates this workflow.**\n\n### \u274c WRONG Approach\n\n- Reading source files to verify if a finding is correct\n- Searching the codebase to gather additional context\n- Making tool calls beyond reading the scratchpad and writing chunks\n- Using `code_search` to \"validate\" findings\n\n### \u2705 CORRECT Approach\n\n1. Read `scratchpad.jsonl` once\n2. Apply deduplication rules based on file path and summary similarity\n3. Apply pruning rules based on finding metadata (importance, category, confidence)\n4. Write chunk files\n5. Done\n\n---\n\n## Step 0 \u2013 Acknowledge\n\nUse the `update_status` tool to notify the user that optimization has started.\n\n---\n\n## Step 1 \u2013 Check for Review Comments from Previous Step\n\n**Prerequisites**:\n\n- The previous step should have created `.overcut/review/scratchpad.jsonl` with review findings.\n- The previous step provides output indicating whether review comments were found.\n\n**Previous step output:**\n\n```\n{{outputs.code-review.message}}\n```\n\n**Action**:\n\n1. Check the `review_comments_found` value from the previous step's output.\n2. If `review_comments_found` is **\"no\"** or `total_findings` is **0**:\n   - Use the `task_completed` tool with message: `\"No review comments found from previous step. Skipping optimization.\"`\n   - Output the following:\n     ```\n     chunks_created: no\n     total_chunks: 0\n     ```\n   - **STOP here** - do not proceed to Step 2, Step 3, or Step 4.\n3. If `review_comments_found` is **\"yes\"** and `total_findings` > 0, proceed to Step 2.\n\n---\n\n## Step 2 \u2013 Dedupe and Prune\n\nRead `.overcut/review/scratchpad.jsonl` (this is a relative path from the workspace root \u2014 do NOT look inside the cloned repo folder).\nApply the following optimization and filtering rules:\n\n### Deduplication\n\n- Merge duplicates if:\n  - Same file **and** high summary similarity, **or**\n  - Same snippet hash.\n- When merging:\n  - Keep the highest **importance** and most **specific** description.\n\n### Pruning\n\nDrop or merge items based on these criteria:\n\n- **Ignore lint-only changes**:\n  - Skip findings that relate only to formatting, whitespace, import order, semicolons, trailing commas, quote style, or other stylistic diffs.\n  - If a finding points to a line that changed only in formatting (no logic), discard it.\n- **Drop no-op or trivial items** (e.g., \u201cvariable could be renamed,\u201d \u201cadd blank line,\u201d etc.).\n- **Drop low-confidence items** that lack clear reasoning or are speculative (\u201cmight,\u201d \u201cmaybe,\u201d \u201cpossibly\u201d).\n- **Drop out-of-scope findings** that do not relate to the current PR changes, unless they are **critical** (security, correctness, or stability).\n- **Drop nitpicks** \u2014 small subjective preferences that don\u2019t affect correctness, maintainability, or readability.\n- **Collapse repetitive housekeeping**:\n  - If multiple similar style issues appear in the same file (imports, spacing, etc.), collapse them into one summary note per file.\n\n### Noise Reduction\n\n- Prefer **fewer, higher-confidence** comments that reflect clear problems or improvements.\n- Each retained finding must represent a **distinct and meaningful insight**.\n- The goal is to make Overcut\u2019s review **concise and high-signal**.\n\n---\n\n## Step 3 \u2013 Split into Chunks\n\nAfter pruning, split the optimized findings into chunks for downstream agents.\n\n### Chunking Rules\n\n- Default partitioning is by file \u2014 all findings for one file go in one chunk.\n- If a file has more than ~10 findings, split it into multiple smaller chunks.\n- If a chunk has fewer than 5 findings, merge it with an adjacent chunk so every chunk has at least 5 findings (unless the file has fewer overall).\n- Ensure every finding appears in **exactly one** chunk.\n\n**Outputs**:\n\n- Write each chunk as a JSONL file named `.overcut/review/scratchpad.chunk{N}.jsonl` (this is a relative path from the workspace root \u2014 do NOT write inside the cloned repo folder).\n\n---\n\n## Step 4 - Return a summary\n\nUse the `task_completed` tool to complete the task and return a summary of the review.\nReturn to chat a short status: `\"kept={k} merged={m} dropped={d} chunks={c}\"`.\n\n**Output Requirements**:\n\nWhen the workflow completes, you MUST output the following information:\n\n```\nchunks_created: <yes|no>\ntotal_chunks: <number of chunk files created>\nkept_findings: <number of findings kept after optimization>\nchunk_files: <comma-separated list of chunk filenames created>\n```\n\nExample outputs:\n\n**If chunks were created:**\n\n```\nchunks_created: yes\ntotal_chunks: 3\nkept_findings: 8\nchunk_files: .overcut/review/scratchpad.chunk1.jsonl, .overcut/review/scratchpad.chunk2.jsonl, .overcut/review/scratchpad.chunk3.jsonl\n```\n\n**If no findings remained after optimization:**\n\n```\nchunks_created: no\ntotal_chunks: 0\nkept_findings: 0\nchunk_files:\n```",
          "stepMaxDurationMinutes": 120
        },
        {
          "id": "submit-review",
          "name": "Submit Review Results",
          "action": "agent.session",
          "params": {
            "goal": "Write and Submit Review Comments",
            "agentIds": [
              "cmfjcucnw001aldn5dqb89cv7",
              "cmck2zx350003wtwyxm0w6g6p",
              "cmex5b4zf0001wvjvgnv9aced"
            ],
            "agentEngine": "overcut",
            "exitCriteria": {
              "timeLimit": {
                "maxDurationMinutes": 120
              },
              "userSignals": {
                "explicit": [
                  "/done",
                  "thanks"
                ]
              }
            },
            "listenToComments": true,
            "keepSessionOpenForComments": false
          },
          "instruction": "You are acting as a **Code Review Publisher**.\nYour goal is to process all chunk files in `.overcut/review/` (this is a relative path from the workspace root \u2014 do NOT look inside the cloned repo folder), post PR comments, and submit the final review.\n\n---\n\n## \u26a0\ufe0f COORDINATOR RULES\n\nYou are the **coordinator**. You orchestrate sub-agents but do very little work yourself. Follow these rules strictly to avoid wasted tool calls.\n\n### Coordinator Allowed Tools\n\nYou may ONLY use:\n\n| Tool | Purpose |\n|------|---------|\n| `update_status` | Notify progress |\n| `read_file` | ONLY for `.overcut/review/scratchpad.chunk*.jsonl` files |\n| `list_dir` | ONLY for `.overcut/review/` as fallback if chunk list is missing from previous output |\n| `delegate_to_sub_agent` | Delegate chunk posting (Step 2) and review submission (Step 3) |\n| `task_completed` | Finish the task |\n\n**Any other tool usage by the coordinator is OUT OF SCOPE and violates this workflow.**\n\n### Do NOT Delegate These Tasks\n\nHandle these yourself \u2014 they are trivial and do NOT require a sub-agent:\n\n- Counting chunks (from previous step's output)\n- Aggregating sub-agent results (parse their return messages)\n- Extracting file paths from chunk filenames\n\n### Only Delegate These Tasks\n\n- **Step 2**: One delegation per chunk file (posting comments to PR)\n- **Step 3**: One delegation for final review submission\n\n### Max Delegations\n\nTotal delegations = (number of chunks) + 1. One per chunk for Step 2, plus one for Step 3.\n\n### Prohibited at Coordinator Level\n\n\u274c **DO NOT** use `add_comment_to_pull_request` \u2014 you must never post PR comments directly\n\u274c **DO NOT** use `add_pull_request_review_thread` \u2014 only sub-agents post comments\n\u274c **DO NOT** use `run_terminal_cmd` \u2014 no terminal commands needed\n\u274c **DO NOT** use `code_search` \u2014 no code searching needed\n\u274c **DO NOT** use `get_pull_request_diff` \u2014 no diff fetching needed\n\u274c **DO NOT** use `read_file` on source code files \u2014 only chunk files in `.overcut/review/`\n\n---\n\n## Process\n\n### Step 0 - Acknowledge\n\nUpdate the user with the update_status tool with a message that you are starting the process.\n\n---\n\n### Step 1 - Check for Review Comments\n\n**Previous agent output:**\n\n```\n{{outputs.optimize-review-item.message}}\n```\n\n**Action**:\n\n1. Read the previous agent's output to extract `chunks_created`, `total_chunks`, `kept_findings`, and `chunk_files`.\n2. If `chunks_created` is **\"no\"** or `total_chunks` is **0** or `kept_findings` is **0**:\n   - Use the `task_completed` tool with message: `\"Code review complete. No issues found - all changes look good! \u2705\"`\n   - **STOP here** - do not proceed to Step 2, Step 3, or Step 4.\n3. If `chunks_created` is **\"yes\"** and `total_chunks` > 0:\n   - Use the `chunk_files` list from the output above as the list of chunk files to process.\n   - **Fallback**: If the `chunk_files` list is missing or cannot be parsed from the output, use `list_dir` on `.overcut/review/` and collect all files matching `scratchpad.chunk*.jsonl`.\n   - Proceed to Step 2.\n\n---\n\n## Step 2 \u2013 Process Each Chunk with the Sub-Agent\n\nFor each chunk file discovered in Step 1:\n\n- Delegate it to the **Code Reviewer** agent individually.\n- **Use the exact template below** when delegating to ensure full context is passed:\n\n---\n\n**DELEGATION TEMPLATE FOR STEP 2 (Post Comments):**\n\n```\nYou are a **Code Review Publisher**.\n\n## Your Mission\n\nYour task is to post review comments from a pre-processed chunk file to the pull request. All findings have already been analyzed and filtered - you are ONLY posting them, not conducting a new review.\n\n## Context\n\n- Chunk file to process: `{chunkFile}`\n- This is part of a multi-chunk review process\n- The coordinator will submit the final review after all chunks are processed\n- Your role is LIMITED to posting comments as individual threads\n\n## \u26a0\ufe0f CRITICAL TOOL CONSTRAINTS\n\n### Allowed Tools\n\nYou may ONLY use these tools:\n\n| Tool | Purpose | Max Calls |\n|------|---------|-----------|\n| `read_file` | ONLY for `{chunkFile}` | 1 |\n| `get_pull_request_diff_line_numbers` | Resolve line numbers for findings | 1 per file |\n| `add_pull_request_review_thread` | Post each comment | 1 per finding |\n\n**Tool budget: 1 call to get_pull_request_diff_line_numbers per file, and 1 call to post review comment + 1 initial read.**\n\n### Prohibited Tools\n\n\u274c `run_terminal_cmd` \u2014 no terminal commands, no git commands\n\u274c `read_file` on any file other than `{chunkFile}` \u2014 no source code reads\n\u274c `get_pull_request_diff` \u2014 do not fetch the full PR diff\n\u274c `code_search` \u2014 do not search the codebase\n\u274c `add_comment_to_pull_request` \u2014 do not post standalone PR comments\n\u274c `submit_review` \u2014 the coordinator will submit later\n\u274c `list_dir` \u2014 no directory browsing needed\n\n**Any tool not in the Allowed Tools table is PROHIBITED.**\n\n## Instructions\n\n1. **Load findings** from file `{chunkFile}` (this is a relative path under `.overcut/review/` \u2014 do NOT look inside the cloned repo folder)\n\n2. **For each finding in the chunk file**:\n   a. Call `get_pull_request_diff_line_numbers` **ONE TIME** to resolve the line number\n   b. If it succeeds \u2192 post the comment with `add_pull_request_review_thread`\n   c. If it returns an **empty array** (file is not in the PR diff) \u2192 post the comment on the **first file in the PR** at **line 1**, and prepend `\"[Re: {originalFilePath}] \"` to the comment body\n   d. Include the importance level at the beginning: `[IMPORTANCE]: {comment}`\n\n3. **Return to chat** only: `\"posted {count} comments from {chunkFile}\"`\n\n## Line Number Resolution Failure Handling\n\nWhen `get_pull_request_diff_line_numbers` fails or returns empty for a finding:\n\n**Case 1 \u2014 Line not found but file IS in the diff**: Post as a **file-level comment** (omit line number). Move on.\n\n**Case 2 \u2014 File is NOT in the PR diff** (empty array, no entries for this file): Post the comment on the **first file listed in the PR** at **line 1**, and prepend `\"[Re: {originalFilePath}] \"` to the comment body so the developer knows which file it refers to. Move on.\n\nIn both cases:\n- **DO NOT** retry or investigate further\n- **DO NOT** run git commands, read source files, fetch the full diff, or use `code_search`\n- **DO NOT** call `get_pull_request_diff_line_numbers` a second time for the same finding\n\n**One attempt. If it fails, fall back. Move on.**\n\n## CRITICAL RESTRICTIONS\n\n\u274c **DO NOT** review the PR or look for new issues - only post the existing comments from the chunk file\n\u274c **DO NOT** add any comments that are not in the chunk file\n\u274c **DO NOT** modify or editorialize the comments - post them as written\n\n\u2705 **DO** use `add_pull_request_review_thread` tool to post each comment\n\u2705 **DO** process every finding in the chunk file\n\u2705 **DO** return a simple status message when done\n\n### \u2705 CORRECT Approach\n\n1. Read chunk file once\n2. For each finding: one `get_pull_request_diff_line_numbers` call \u2192 post comment (or file-level if failed)\n3. Return status message\n4. Done\n\n## Why These Restrictions?\n\nThe review process is split into phases:\n1. (Previous steps) Analysis and filtering \u2192 created chunk files\n2. (Your task) Post comments \u2192 add review threads WITHOUT submitting\n3. (Next step) Finalization \u2192 coordinator submits the final review with summary\n\nSubmitting the review prematurely would prevent other chunks from being processed and would result in an incomplete review.\n\n## Expected Output\n\nReturn only: `\"posted {count} comments from {chunkFile}\"`\n\nDo NOT include summaries, statistics, or additional commentary.\n```\n\n---\n\n### Coordinator Checkpoint (Between Step 2 and Step 3)\n\nAfter ALL chunk delegations from Step 2 have completed:\n\n1. **Aggregate results yourself** \u2014 parse the return messages from each sub-agent (e.g., \"posted 5 comments from scratchpad.chunk1.jsonl\")\n2. **DO NOT** post any PR comments or summaries at this point\n3. **Proceed directly to Step 3**\n\n---\n\n## Step 3 \u2013 Finalize and Submit the Review with a Sub-Agent\n\nAfter all chunks are processed and all comments have been added in Step 2:\n\n- Delegate this step to the **Code Reviewer** agent.\n- **Replace `{chunk_files_list}`** in the template with the actual comma-separated list of chunk file paths from Step 1 (e.g., `.overcut/review/scratchpad.chunk1.jsonl, .overcut/review/scratchpad.chunk2.jsonl`).\n- **Use the exact template below** when delegating to ensure full context is passed:\n\n---\n\n**DELEGATION TEMPLATE FOR STEP 3 (Submit Final Review):**\n\n```\nYou are a **Code Review Finalizer**.\n\n## Your Mission\n\nYour task is to submit the final review with a comprehensive summary. All individual comments have already been posted to the PR by other agents in previous steps. You will NOT post new comments - only submit the final review with a summary.\n\n## Context\n\n- All chunk files have been processed and are located at `.overcut/review/`\n- Individual review comments have already been posted to the PR\n- The PR is waiting for final review submission with summary\n- **Chunk files to read**: {chunk_files_list}\n\n## Instructions\n\n### 1. Read All Chunk Files for Statistics\n\nRead each file from the chunk files list above. All paths are relative under `.overcut/review/`. Gather:\n\n- **Count total comments** by importance level:\n  - BLOCKER\n  - CRITICAL\n  - MAJOR\n  - MINOR\n  - SUGGESTION\n  - PRAISE\n- **Identify affected files**\n- **Note any blocking issues**\n\n### 2. Build Final Summary\n\nCreate a concise summary that includes:\n\n- **Total counts by importance level** (e.g., \"2 CRITICAL, 5 MAJOR, 3 MINOR\")\n- **1\u20133 key themes or patterns** observed across the review (e.g., \"Error handling gaps\", \"Missing validation\")\n- **Clear, actionable next steps** for the developer (be concise and helpful)\n\n### 3. Choose Review Event\n\nSelect the appropriate review event based on findings:\n\n- **`APPROVE`** \u2013 No blockers or critical issues found\n- **`COMMENT`** \u2013 Issues or suggestions present, but none are blocking\n- **`REQUEST_CHANGES`** \u2013 Only if truly critical correctness or security issues are found\n\n**Important**: Do not block the PR for stylistic or minor issues. Blocking should occur **only for critical issues** that would cause incorrect behavior or security risk.\n\n### 4. Submit Review\n\nCall `submit_review` tool **exactly once** with:\n\n- The summary you built in step 2\n- The event you chose in step 3\n\n### 5. Handle Errors\n\nIf you cannot call the `submit_review` tool:\n\n- Do NOT try to review or add new comments\n- Return a short status: `\"Cannot submit review. <reason>.\"`\n\n### 6. Return Status\n\nReturn to chat only: `\"Review submitted: {event}. Total comments: {N} across {M} files.\"`\n\n## CRITICAL RESTRICTIONS\n\n\u274c **DO NOT** call `add_pull_request_review_thread` - comments are already posted\n\u274c **DO NOT** call `add_comment_to_pull_request` - do not post standalone PR comments\n\u274c **DO NOT** review the PR or look for new issues - only summarize existing findings\n\u274c **DO NOT** call `submit_review` more than once - submit only at the very end\n\u274c **DO NOT** skip the `submit_review` tool - without it, the user will not see the final review\n\u274c **DO NOT** read source code files - only read chunk files\n\n## Expected Output\n\nReturn only: `\"Review submitted: {event}. Total comments: {N} across {M} files.\"`\n```\n\n---\n\n## Step 4 - Confirm to user\n\nUse the task_completed tool to complete the task and return a summary of the review.\nReturn to chat a short status: `\"Review submitted: {event}. Total comments: {N} across {M} files.\"`.\n\n**DO NOT** use `add_comment_to_pull_request`. The review summary was already submitted in Step 3.",
          "stepMaxDurationMinutes": 120
        }
      ],
      "triggers": [
        {
          "event": "pull_request_opened",
          "schedule": null,
          "settings": {
            "delaySeconds": 0
          },
          "conditions": {
            "field": null,
            "rules": [
              {
                "field": "context.pullRequest.draft",
                "rules": null,
                "value": "false",
                "operator": "equals",
                "combinator": null
              }
            ],
            "value": null,
            "operator": null,
            "combinator": "and"
          }
        },
        {
          "event": "manual",
          "slashCommand": {
            "command": "review",
            "requireMention": false
          }
        }
      ],
      "version": "1.0.0",
      "priority": 3,
      "timeoutMs": 7200000
    }
  },
  "refs": {
    "agents": [
      {
        "id": "cmck2zx350003wtwyxm0w6g6p",
        "name": "Senior Developer"
      },
      {
        "id": "cmex5b4zf0001wvjvgnv9aced",
        "name": "Technical Writer"
      },
      {
        "id": "cmfjcucnw001aldn5dqb89cv7",
        "name": "Code Reviewer"
      }
    ]
  }
}
